## Chapter 09 보안

### Chapter 9.1 보안의 개념과 정의

다음의 3대 보안 정의를 보안의 필수 요소로 볼 수 있습니다.

• 기밀성(Confidentiality)

>인가되지 않은 사용자가 정보를 보지 못하게 하는 작업입니다. 가장 대표적인 기밀성은 암호화 작업입니다.


• 무결성(Integrity)
> 정확하고 완전한 정보 유지에 필요한 모든 작업을 말합니다. 누군가가 정보를 고의로 훼손하거나 중간에 특정 이유로 변경이 가해졌을 때, 그것을 파악해 잘못된 정보가 전달되거나 유지되지 못하게 하는 것이 무결성입니다.

• 가용성(Availability)
> 정보가 필요할 때, 접근을 허락하는 일련의 작업입니다. 보안에 대해 잘 모르는 분들은 가용성이 보안에 포함된 것이 의아할 수 있습니다. 우리가 유지하는 정보에 대해 사고날 염려 없이 온전한 상태를 유지하는 것이 정보 보안이므로 어떤 이유에서라도 그 정보를 사용할 수 없는 상황이라면 정보 보안에 실패한 것입니다.

이 3대 요소 외에 추가로 진정성, 책임성, 부인 방지, 신뢰성 유지를 정보 보안 활동 중 하나로 정의하기도 합니다.

#### 9.1.2 네트워크의 정보 보안

 정보를 가진 시스템을 공격해 유출하거나 사용하지 못하게 하거나 시스템이 동작하지 못하게 해 정보 서비스를 정상적으로 구동할 수 없게 만드는 행위를 네트워크에서 적절히 막는 것이 네트워크 보안의 1차 목표입니다. 
 
 또한, 정보는 여러 가지 서비스를 제공하기 위해 한 자리에만 있는 것이 아니라 네트워크를 통해 복제, 이동되므로 그 유출을 막는 것이 2차 목표입니다.


#### 9.1.3 네트워크 보안의 주요 개념

네트워크 보안의 목표는 외부 네트워크로부터 내부 네트워크를 보호하는 것입니다. 이때 외부로부터 보호받아야 할 네트워크를 트러스트(Trust) 네트워크, 신뢰할 수 없는 외부 네트워크를 언트러스트(Untrust) 네트워크로 구분합니다.

우리가 운영하는 내부 네트워크이지만 신뢰할 수 없는 외부 사용자에게 개방해야 하는 서비스 네트워크인 경우, DMZ 네트워크라고 부른다.

![Alt text](images9/image.png)

네트워크 보안 분야는 트래픽의 방향과 용도에 따라 두 가지로 나눌 수 있습니다.

• 인터넷 시큐어 게이트웨이(Internet Secure Gateway)

- 트러스트(또는 DMZ) 네트워크에서 언트러스트 네트워크로의 통신을 통제

• 데이터 센터 시큐어 게이트웨이(Data Center Secure Gateway)

- 언트러스트 네트워크에서 트러스트(또는 DMZ)로의 통신을 통제

![Alt text](images9/image-1.png)

![Alt text](images9/image-2.png)

#### 9.1.3.1 네트워크 보안 정책 수립에 따른 분류
- 화이트리스트
>화이트리스트는 방어에 문제가 없다고 명확히 판단되는 통신만 허용하는 방식. 일반적으로 회사 내부에서 사용하는 방화벽이 명확한 정책에 의해 필요한 서비스만 허용하는 화이트리스트 방식을 주로 사용한다.

- 블랙리스트
> 방어는 공격이라고 명확히 판단되거나 문제가 있었던 IP 리스트나 패킷 리스트를 기반으로 데이터베이스를 만들고 그 정보를 이용해 방어하는 형태.

#### 9.1.3.2 정탐, 오탐, 미탐(탐지 에러 타입)
공격을 탐지할 때 원래 예상한 내용과 다른 결과가 나올 수 있다. 이런 경우를 오탐지, 미탐지로 구분하고 정상적으로 탐지한 경우를 정상 탐지으로 표현한다. 예상했던 상황과 탐지 결과에 따라 4가지 경우가 나타날 수 있다.

![Alt text](images9/image-3.png)

#### 9.1.4 네트워크 정보 보안의 발전 추세와 고려사항
트워크 보안 장비와 서비스를 이해하려면 인프라스트럭처의 변화와 해킹 기법의 발전을 모두 이해해야 하고 반대로 인프라스트럭처의 발전을 이용해 더 높은 수준의 네트워크 보안을 제공하는 보안업체의 대응도 눈여겨 보아야 합니다.

### Chapter 9.2 보안 솔루션의 종류

![Alt text](images9/image-4.png)

#### 9.2.1 DDoS 방어 장비
Denial of Service 공격의 약자로, 다양한 방법으로 공격 목표에 서비스 부하를 가해 정상적인 서비스를 방해하는 공격 기법

#### 9.2.2 방화벽
4계층에서 동작하는 패킷 필터링 장비. 일반적으로 방화벽은 DDoS 방어 장비 바로 뒤에 놓는 네트워크 보안 장비이고 3, 4계층에서 동작하므로 다른 보안 장비보다 비교적 간단히 동작하고 성능도 우수하다.

#### 9.2.3 IDS, IPS
IDS(Intrusion Detection System; 침입 탐지 시스템)와 IPS(Intrusion Prevention System; 침입 방지 시스템)는 방화벽에서 방어할 수 없는 다양한 애플리케이션 공격을 방어하는 장비입니다.

최근에는 애플리케이션을 골라 방어할 수 있는 애플리케이션 컨트롤 기능이 추가되면서 화이트리스트 기반의 방어 기법도 IPS 장비에 적용할 수 있게 되었다.

#### 9.2.4 WAF
WAF(Web Application Firewall)는 웹 서버를 보호하는 전용 보안 장비로 HTTP, HTTPS처럼 웹 서버에서 동작하는 웹 프로토콜의 공격을 방어한다.

IPS에서 방어할 수 없는 IPS 회피 공격을 방어할 수 있다. IPS는 데이터를 조합하지 않고 처리하지만 WAF는 프록시 서버와 같이 패킷을 데이터 형태로 조합해 처리하기 때문에 회피 공격을 쉽게 만들기 어렵다.

#### 9.2.5 샌드박스
보안 장비들이 발전하면서 해커들이 방화벽을 직접 뚫고 원하는 목적지로 공격하는 것이 점점 어려워지면서 기존과 다른 방향의 공격을 개발하게 되었습니다.

현재 APT와 ATA라는 공격이 나오게되면서 샌드박스는 APT의 공격을 방어하는 대표적인 장비로 악성 코드를 샌드박스 시스템 안에서 직접 실행시켜 방어합니다.

#### 9.2.6 NAC
네트워크에 접속하는 장치들을 제어하기 위해 개발되었습니다. 내부 PC를 아무리 잘 관리하고 보안 패치를 신속히 수행하더라도 외부 PC가 내부망에 접속해 보안사고를 일으키거나 악성 코드를 전파하는 문제점들이 많이 발생하자 이것을 해결하기 위해 개발되었습니다.

#### 9.2.7 IP 제어
보안사고 추적이 쉽도록 고정 IP 사용 권고 지침이 금융권에 내려오면서 IP를 할당하고 추적하는 솔루션이 필요해졌고 할당된 IP를 관리하고 나아가 정확히 의도된 IP 할당이 아니면 정상적으로 네트워크를 사용하지 못하게 하는 기능이 필요했습니다. 이 요구사항들을 구현하기 시작한 것이 IP 제어 솔루션입니다.

#### 9.2.8 접근 통제
![Alt text](images9/image-5.png)

서버나 데이터베이스에 대한 직접적인 접근을 막고 작업 추적 및 감사를 할 수 있는 접근 통제 솔루션

#### 9.2.9 VPN
![Alt text](images9/image-6.png)

사용자 기반의 VPN 서비스를 제공해주는 장비

### Chapter 9.3 방화벽

네트워크 중간에 위치해 해당 장비를 통과하는 트래픽을 사전에 주어진 정책 조건에 맞추어 허용하거나 차단하는 장비

![Alt text](images9/image-7.png)


#### 9.3.2 초기 방화벽
방화벽은 상태 기반 엔진(SPI)를 가지고 있어야한다. 초기에는 이 엔진이 없었기에 패킷의 인과 관계를 확인하지 못하고 장비에 등록된 정책만으로 단순히 패킷을 필터링했다.

이런 초기 방화벽을 스테이트리스 또는 패킷 필터 방화벽이라고 불렀다.

이와 같은 패킷 필터링 방화벽은 지정된 구간에서 간단한 정책을 정의할 때는 큰 문제가 없지만 인터넷 통신과 같이 불특정 다수 기반의 정책을 정의할 때는 룰셋(Ruleset)이 복잡해지고 보안이 약화되는 문제가 있습니다. 

또한, 패킷 단위의 필터링이므로 5-튜플 외의 3, 4계층 헤더를 변조해 공격하면 적절한 방어가 불가능합니다.

하지만 패킷 필터링 자체는 다른 세대의 방화벽 엔진들보다 부하가 적고 간단히 동작하므로 완전히 없어지지 않고 네트워크 장비에서 사용되거나 현대적인 일부 방화벽에서도 특수한 기능을 위해 남겨 놓습니다

#### 9.3.3 현대적 방화벽의 등장(SPI 엔진)
기존 패킷 필터 방화벽이 패킷의 상태값 없이 순수하게 정책만으로 제어하던 한계를 극복하기 위해 개발된 것이 상태 기반 방화벽(Stateful Inspection Firewall)입니다. 현재 우리가 ‘방화벽’이라고 부르는 모든 장비는 세션 기반으로 동작하는 상태 기반(SPI) 엔진을 탑재하고 있습니다.

SPI 엔진은 패킷의 인과 관계와 방향성을 인지해 정책을 적용할 수 있어 내부 네트워크에서 인터넷으로 통신할 때 유용하게 사용됩니다. 

내부에서 외부 인터넷으로 통신을 시도해 받은 응답과 외부에서 내부로 직접 들어오려는 패킷을 구분할 수 있습니다.

#### 9.3.4 방화벽 동작 방식
![Alt text](images9/image-8.png)

1. 장비에 패킷이 들어오면 우선 세션 상태 테이블을 확인합니다.

2. 조건에 맞는 세션 정보가 세션 테이블에 있을 때, 포워딩 테이블을 확인합니다(라우팅, ARP 포함).

3. 조건에 맞는 세션 정보가 세션 테이블에 없을 때, 방화벽 정책을 확인합니다.

4. 방화벽 정책은 맨 위의 정책부터 확인해 최종 정책까지 확인한 후 없을 때 암시적인 거부(Implicit Denial) 규칙을 참고해 차단됩니다.

5. 허용 규칙이 있으면 내용을 세션 테이블에 적어 넣습니다.

6. 포워딩 테이블을 확인합니다(라우팅, ARP 포함).

7. 조건에 맞는 정보가 포워딩 테이블에 있을 때, 적절한 인터페이스로 패킷을 포워딩합니다.

8. 조건에 맞는 정보가 포워딩 테이블에 없을 때, 패킷을 폐기합니다.

#### 9.3.5 ALG
세션 기반으로 동작하는 방화벽은 세션의 방향성이 매우 중요한데 FTP 액티브 모드(Active Mode)에서는 초기 접속 방향과 반대로 데이터 프로토콜이 동작하므로 방화벽을 정상적으로 통과할 수 없습니다.

이 문제를 해결하기 위해 FTP 통신 방식을 패시브 모드로 변경하면 되지만 패시브 모드 자체를 제공하지 못하는 컴포넌트가 있을 수 있고 이미 개발된 애플리케이션 변경이 불가능한 경우도 있습니다. 

그래서 방화벽에서 FTP 액티브 모드를 통과시키기 위해 애플리케이션 프로토콜을 확인하고 필요에 따라 세션을 인지해 포트를 자동으로 열어줍니다. 이것을 ALG(Application Layer Gateway) 기능이라고 합니다. 

#### 9.3.6 방화벽의 한계
 알려진 취약점을 악용한 다양한 공격을 방어할 수 없습니다.
 
 취약점은 대부분 애플리케이션이나 애플리케이션 프로토콜에서 보유하고 있어 애플리케이션 영역을 검사하지 못하는 방화벽으로서는 대응이 불가능했습니다.

### Chapter 9.4 IPS, IDS

애플리케이션 계층에서 이루어지는 이런 다양한 공격을 탐지, 방어하기 위해 IDS와 IPS가 개발되었습니다.

![Alt text](images9/image-9.png)

#### 9.4.1 IPS, IDS의 정의
IDS란 Intrusion Detection System(침입 탐지 시스템)의 약자입니다. 공격자가 시스템을 해킹할 때 탐지를 목적으로 개발된 시스템입니다. ‘방어’보다 ‘탐지’에 초점을 맞추어 개발되어 공격에 직접 개입하거나 방어하는 것이 아니라 트래픽을 복제해 검토하고 침입 여부를 판별합니다.

#### 9.4.2 IPS, IDS의 동작 방식

기본적으로 IPS는 공격 데이터베이스(Signature)를 사용한 패턴 매칭 방식으로 운영되지만 프로토콜 어노말리(Protocol Anomaly), 프로파일 어노말리(Profile Anomaly) 등의 다른 기법으로 공격을 방어합니다.

#### 9.4.2.1 패턴 매칭 방식

IPS에는 공격을 탐지, 방어하는 다양한 기술이 있습니다. 기존 공격이나 취약점을 통해 공격 방식에 대한 데이터베이스를 습득하고 그 최신 내용을 유지하다가 공격을 파악하는 기술을 패턴 방식, 시그니처(Signature) 방식, 데이터베이스 방식 방어라고 합니다. 

이런 패턴 기반 방어가 IPS 기능의 상당 부분을 차지하므로 IPS는 많은 공격 데이터베이스를 보유(최근 대부분의 IPS 생산업체는 만 개 이상의 공격 데이터베이스를 보유하거나 적용하고 있다)해야 하고 최신 공격 방식을 공격 데이터베이스에 최대한 신속히 반영하는 것이 매우 중요합니다.

#### 9.4.2.2 어노말리 공격 방어

패턴 매칭 기반의 방어가 유효하려면 실제로 공격이 들어오기 전에 해당 공격에 대한 패턴 데이터베이스가 확보되어 있어야 합니다. 

웜의 알고리즘이 점점 진화해 단 4시간 만에 인터넷 전체에 퍼집니다. 일반적인 정기 업데이트가 하루부터 수일 사이인 패턴 데이터베이스 업데이트로는 이렇게 급속히 전파되고 진화하는 공격을 효과적으로 방어할 수 없었습니다. 

기존 블랙리스트 기반의 방어 방식인 패턴 기반 방어의 한계 때문에 IPS에서도 화이트리스트 기반의 방어 기법이 개발되었는데 바로 어노말리입니다. 

• 프로파일 어노말리

프로파일 어노말리는 평소 관리자가 정해놓은 기준이나 IPS 장비가 모니터링해 정해진 기준과 다른 행위가 일어나면 공격으로 판단합니다. 

웜이 감염되면 다른 타깃으로 다량의 트래픽을 발생시켜 감염시키는 행위를 반복하므로 이런 형태의 공격을 방어하는 데 효과가 있었습니다.

• 프로토콜 어노말리

SPI 방화벽과 NAT 기능이 대중화되면서 해커가 직접 일반 사용자의 PC를 쉽게 공격할 수 없게 되었습니다. 

상태 기반 SPI 방화벽에서 인터넷으로 나가는 방향의 통신은 모두 허용하고 인터넷에서 내부로 들어오는 방향의 통신은 모두 거부하는 것만으로도 외부에서 내부로 직접 공격할 수 없게 되었습니다.

#### 9.4.3 IPS, IDS의 한계와 극복

최근 기존 IPS의 기능을 향상시켜 문제점을 해결한 NGIPS(Next Generation IPS) 개념의 장비가 출시되었습니다. 

애플리케이션을 인지하거나 다양한 시스템과 연동할 수 있고 특히 APT 공격을 방어하기 위한 일부 기능이 탑재되어 있거나 다양한 외부 시스템과 연동할 수 있는 NGIPS 장비들이 많이 소개되고 있습니다.

 방화벽이 NGFW, UTM으로 발전했듯이 IPS도 다양한 장비가 통합되는 추세이고 IPS 단독시장은 축소되고 있습니다.

### Chapter 9.5 DDoS 방어 장비

기존 공격은 직접 공격해 관리자 권한을 탈취하는 데 초점이 맞추어져 있었다면 방화벽 대중화 이후의 공격은 정상적인 서비스가 불가능하도록 방해하는 데 초점이 맞추어져 있습니다. 이 공격 방식을 DoS(Denial of Service) 공격이라고 합니다.

![Alt text](images9/image-10.png)

#### 9.5.1 DDoS 방어 장비의 정의
DDoS 방어 장비는 볼류메트릭 공격을 방어하기 위해 트래픽 프로파일링 기법을 주로 사용하고 인터넷의 다양한 공격 정보를 수집한 데이터베이스를 활용합니다.

#### 9.5.2 DDoS 방어 장비 동작 방식

DDoS 방어 서비스로는 클라우드 서비스, 회선 사업자의 방어 서비스, DDoS 방어 장비를 사내에 설치하는 방법이 있습니다. 

회선 사업자와 DDoS 방어 장비를 이원화해 협조하는 서비스도 많이 등장하고 있습니다. 

DDoS는 워낙 대규모 공격이므로 DDoS 탐지 장비와 방어 장비를 구분하는 경우가 많았습니다. 

DDoS 공격을 탐지해 공격을 수행하는 IP 리스트를 넘겨주면 방어 장비나 ISP 내부에서 이 IP를 버리는 것이 가장 흔한 DDoS 방어 기법입니다.

#### 9.5.3 DDoS 공격 타입

DDoS 공격은 다양한 기법이 있지만 일반적으로 회선 사용량을 가득 채우는 볼류메트릭 공격 (Volumetric Attack)과 3, 4계층의 취약점과 리소스 고갈을 노리는 프로토콜 공격(Protocol Attack), 애플리케이션의 취약점을 주로 노리는 애플리케이션 공격(Application Attack) 3가지가 있습니다. 다음은 DDoS의 주요 공격 타입을 정리한 표입니다.

![Alt text](images9/image-11.png)

#### 9.5.4 볼류메트릭 공격
볼류메트릭 공격은 회선 사용량이나 그 이상의 트래픽을 과도하게 발생시켜 회선을 사용하지 못하도록 방해하는 공격이므로 회선을 공급해주는 ISP 내부나 사용자 네트워크 최상단에 위치시켜 이 공격을 완화(Mitigation)해야 합니다. 

DDoS 장비는 주로 볼류메트릭 공격이나 프로토콜 공격을 방어하는 데 사용됩니다. 혼자 방어할 수 없는 공격도 많으므로 회선을 공급하는 ISP와 공조해 방어할 필요가 있습니다.

### Chapter 9.6 VPN

VPN은 Virtual Private Network의 약자입니다. 2.2.4 VPN 절에서 알아보았듯이 물리적으로 전용선이 아닌 공중망을 이용해 논리적으로 직접 연결한 것처럼 망을 구성하는 기술입니다. 

이렇게 논리적으로 직접 연결된 것처럼 만들어주는 통로를 터널(Tunnel)이라고 하며 VPN을 이용하면 터널을 이용해 직접 연결한 것처럼 동작합니다.

#### 9.6.1 VPN 동작 방식

VPN은 가상 네트워크를 만들어주는 장비로 터널링 기법을 사용합니다. 패킷을 터널링 프로토콜로 감싸 통신하는 기법이 터널링 기법입니다.

일반적으로 VPN이라고 부르는 프로토콜은 터널링에 보안을 위한 다양한 기술이 포함되어 있습니다. 

패킷을 암호화하거나 인증하거나 무결성을 체크하는 보안 기능을 이용해 인터넷에 패킷이 노출되더라도 해커나 기관들이 감청하지 못하도록 보호할 수 있습니다. 현재 가장 많이 사용되는 보안 VPN 프로토콜은 IPSEC과 SSL입니다.

일반적으로 VPN은 3가지 형태로 구현됩니다.

1. Host to Host 통신 보호

2. Network to Network 통신 보호

3. Host가 Network로 접근할 때 보호

Host to Host 통신은 두 호스트 간에 직접 VPN 터널을 연동하는 기법입니다. 

Host to Host VPN은 VPN 구성으로 잘 사용하지 않습니다. 

일반적인 VPN 장비에서 제공하는 기능은 Network to Network과 Host to Network 통신 보호 기능입니다.

![Alt text](images9/image-12.png)

Network to Network 통신은 본사-지사 같은 특정 네트워크를 가진 두 종단을 연결하는 경우이며 IPSEC 프로토콜 스택이 가장 많이 사용됩니다.

![Alt text](images9/image-13.png)

Host to Network 통신은 모바일 사용자가 일반 인터넷망을 통해 사내망으로 연결하는 경우이며 IPSEC과 SSL 프로토콜이 범용적으로 사용됩니다.

![Alt text](images9/image-14.png)