# Ch07. 통신을 도와주는 네트워크 주요 기술

---

Contents

7.1 NAT/PAT의 용도와 필요성

7.2 DNS

7.3 GSLB

7.4 DHCP

---

### **☑️  keywords**

- **DHCP**
    
    사용자가 IP 설정을 하지 않더라도 IP 주소를 자동으로 할당함
    
    (Dynamic Host Configuration Protocol)
    
- **DNS**
    
    사용자가 복잡한 목적지 IP를 기억하지 않고 쉬운 도메인 이름을 사용하도록 도메인 이름과 IP 주소를 매핑함
    
    (Domain Name System)
    
- **GLBS**
    
    사용자가 가장 가까운 지역의 데이터 센터에 접속해 신속한 서비스를 받게 해줌
    
    (Global Service Load Balancing)
    
- **NAT**
    
    하나의 IP를 사용해 여러 단말 장비를 포함하는 네트워크를 손쉽게 구축하도록 도와줌
    
    (Network Address Translation)
    

---

# 7.1 NAT / PAT

- **NAT** (Network Address Translation, 네트워크 주소 변환)
    - IP 주소를 다른 IP 주소로 변환해 라우팅을 원활히 해주는 기술
    - 사용자 모르게 실생활에서 많이 사용하는 기술
    - 가정에서 사용하는 노트북과 PC는 공유기를 통해, 통신사에서 LTE나 5G로 연결된 스마트폰은 통신사 장비 어디선가 NAT를 수행해 외부와 통신함
    
    - NAT는 기본적으로 하나의 네트워크 주소에 다른 하나의 네트워크 주소로 변환하는 1:1 변환이 기본
    - But, IP 주소가 고갈되는 문제를 해결하기 위해 1:1 변환이 아닌 여러 개의 IP를 하나의 IP로 변환하기도 함
        
        → 이 기술도 NAT 기술 중 하나이고, NAT로 통칭하여 불리기도 하지만 실제 공식 용어는 NAPT(Network Address Port Translation)
        
        실무에서는 PAT(Port Address Translation) 라는 용어로 더 많이 사용
        
    - 사설 IP → 공인 IP, 공인 IP → 사설 IP, 사설 IP → 사설 IP, 공인 IP → 공인 IP
    - 위의 개념을 확장하면 IPv4 주소를 IPv6 주소로 변환하거나 그 반대로 ↑ 주소를 변환하는 기술인 AFT(Address Family Translation)도 NAT 기술의 일종임
    - 다양한 NAT 기술과 방법 중 NAT가 가장 많이 사용되는 경우 : **사설 IP → 공인 IP**

## 7.1.1 NAT / PAT의 용도와 필요성

1. IPv4 주소 고갈의 솔루션으로 NAT가 사용됨
    
    인터넷 대중화로 폭증한 IP 주소 요구를 극복하기 위해 단기, 중기, 장기의 3단계 IP 주소 보존과 전환 전략을 수립
    
2. 보안 강화에 NAT 기술 사용
3. IP 주소 체계가 같은 두 개의 네트워크 간 통신을 가능하게 함
4. 불필요한 설정을 줄일 수 있음

## 7.1.2 NAT 동작 방식

<그림 7-3>

출발지 사용자(10.10.10.10)가 목적지 웹 서버(20.20.20.20)로 통신하는 과정

## 7.1.3 PAT 동작 방식

<그림 7-4>

출발지 사용자(10.10.10.10)가 목적지 웹 서버(20.20.20.20)로 통신하는 과정

PAT는 다수의 IP가 있는 출발지에서 목적지로 갈 때 NAT 테이블이 생성되고 응답에 대해 NAT 테이블을 참조할 수 있지만, PAT IP가 목적지일 때는 해당 IP가 어느 IP에 바인딩되는지 확인할 수 있는 NAT 테이블이 없으므로 사용할 수 없음

즉, PAT는 뒤에서 다룰 SNAT, DNAT 중 SNAT에 대해서만 적용되고, DNAT에는 적용되지 않음

## 7.1.4 SNAT와 DNAT

NAT를 사용해 네트워크 주소를 변환할 때 어떤 IP 주소를 변환하는지에 따라 두가지로 구분함

- SNAT(Source NAT)          - 출발지 주소를 변경하는 NAT
- DNAT(Destination NAT)  - 도착지 주소를 변경하는 NAT

- SNAT, DNAT는 트래픽이 출발하는 시작 지점을 기준으로 구분함
- 어떤 주소를 변경해야 하는지는 서비스 흐름, 목적에 따라 결정됨

- SNAT
    - 사설 → 공인 통신시 많이 사용
    - 내부의 실제 IP 주소를 숨길 수 있어 보안상의 이유로 사용
    - 로드밸런서의 구성에 따라 사용
        
        출발지와 목적지 서버가 동일한 대역일 때 로드밸런서 구성에 따라 트래픽이 로드 밸런서를 거치지 않고 응답할 수 있어 SNAT를 통해 응답 트래픽이 로드 밸런서를 거치게 할 수 있음
        
- DNAT
    - 로드밸런서에서 많이 사용
        
        사용자는 서비스 요청을 위해 로드밸런서에 설정된 서비스 VIP(Virtual IP)로 서비스를 요청하고, 로드밸런서에서는 서비스 VIP를 로드 밸런싱 될 서버의 실제 IP로 DNAT해 내보냄
        
    - 사내가 아닌 대외망과 네트워크 구성에서 사용

## 7.1.5 동적 NAT와 정적 NAT

- 정적 NAT : 출발지와 목적지의 IP를 미리 매핑해 고정해놓은 NAT
- 동적 NAT : 출발지와 목적지가 모두 정의된 것이 아니라 다수의 IP 푸레서 정해지므로 최소한 출발지나 목적지 중 한곳이 다수의 IP로 구성된 IP 풀이나 레인지로 설정되어 있음

- 동적 NAT vs 정적 NAT
    
    
    |  | 동적 NAT | 정적 NAT |
    | --- | --- | --- |
    | NAT 설정 | 1:N, N:1, N:M | 1:1 |
    | NAT 테이블 | NAT 수행 시 생성 | 사전 생성 |
    | NAT 테이블 타임아웃 | 동작 | 없음 |
    | NAT 수행 정보 | 실시간으로만 확인하거나 별도 변경 로그 저장 필요 | 별도 필요 없음
    (설정 = NAT 내역) |

# 7.2 DNS

- 네트워크 프로토콜
    - 데이터 프로토콜
        
        실제로 데이터를 실어 나름
        
    - 컨트롤 프로토콜
        
        데이터 프로토콜이 잘 동작하도록 도와줌
        
        통신에 직접 관여 X, 통신 관계를 맺거나 유지하는데 큰 역할
        
        → 이 중 DNS(Domain Name System)는 도메인 주소를 IP 주소로 변환하는 역할
        

## 7.2.1. DNS 소개

사이트에 접속하거나 링크에 지정된 주소는 [http://202.179.177.21](http://202.179.177.21) 같은 IP 주소이거나,

[http://www.naver.com](http://www.naver.com)  같은 도메인 주소 사용

어떤 주소를 사용하더라도 실제 네트워크 통신에서는 202.179.177.21 같은 IP 주소를 이용하지만,

IP 주소가 외우기 어렵기 떄문에 도메인 주소 사용

사용자가 웹 브라우저에 [naver.com](http://naver.com) 입력하면 DNS 서버에 naver.com 의 주소가 무엇인지 질의하고, DNS 서버는 naver.com의 IP 주소가 202.179.177.21 이라고 사용자에게 알려줌

## 7.2.1. DNS 구조와 명명 규칙

도메인은 계층 구조이기 때문에 수많은 인터넷 주소 중 원하는 주소를 효율적으로 찾아갈 수 있음

역트리 구조로 최상위 루트부터 Top-Level 도메인, Second-Level 도메인, Third-Level 도메인과 같이 하위 레벨로 원하는 주소를 단계적으로 찾아감

각 계층의 경계를 “.” 으로 표시하고, 뒤에서 앞으로 해석

<그림 7-13>

- 도메인은 최대 128계층까지 구성 가능
- 계층별 길이는 최대 63바이트까지 가능
- 도메인 계층을 구분하는 구분자 “.”를 포함한 전체 도메인 네임의 길이는 최대 255바이트까지 사용 가능
- 문자는 알파벳, 숫자, “-”만 사용 가능
- 대소문자 구분 없음

1. 루트 도메인
    
    도메인을 구성하는 최상위 영역
    
    DNS 서버는 사용자가 쿼리한 도메인에 대한 값을 직접 갖고있거나 캐시에 저장된 정보를 이용해 응답
    
    루트 DNS는 전 세계에 13개 존재
    
2. Top-Level Domain (TLD)
    
    최상위 도메인인 TLD는 IANA에서 구분한 6가지 유형으로 구분
    
    - Generic(gTLD)
    - country-code(ccTLD)
    - sponsored(sTLD)
    - infrastructure
    - generic-restricted(grTLD)
    - test(tTLD)

## 7.2.3 DNS 동작 방식

도메인을 IP 주소로 변환하려면 **DNS 서버에 도메인 쿼리 하는** 과정을 거쳐야 한다.

도메인을 쿼리 하면 DNS 서버에 쿼리를 하기 전 로컬에 있는 DNS 캐시 정보를 먼저 확인한다. 이는 동일한 도메인을 매번 질의하지 않고 캐시를 통해 성능을 향상하기 위해서이다.

캐시 정보에는 DNS조회를 통해 확인한 동적 DNS 캐시와 hosts 파일에 저장되어 있는 정적 DNS 캐시가 존재한다.

캐시에 필요한 도메인 정보가 없다면 DNS 서버로 쿼리를 수행하고 DNS 서버로부터 응답을 받으면 그 결과를 캐시에 먼저 저장한다.

윈도우에서 DNS 캐시를 확인하는 방법은 cmd 창에서 'ipconfig /displaydns' 명령을 사용한다.

인터넷 상용화 전에는 hosts 파일을 이용해 호스트 이름과 IP을 매핑하여 사용했다. 하지만 상용화된 후에는 폭증하는 단말들을 중앙화된 체계로 수용하기 위해 DNS 체계가 만들어졌다.

아래는 캐시와 DNS를 이용해 도메인 이름 쿼리를 하는 예제이다. 로컬 캐시를 조회 후 로컬 캐시에 없다면 DNS 서버로 다시 쿼리 한다

<그림 7-17>

로컬 캐시 유무에 따른 도메인 쿼리 방법

해당 과정은 DNS 시스템 관점에서 도메인에 대한 결괏값을 클라이언트에 보내주는 과정이다.

기본적으로 DNS는 분산된 데이터베이스로 서로 도와주도록 설계되었는데 자신이 가진 도메인 정보가 아니면 다른 DNS에 질의해 결과를 받는다.

DNS 기능을 서버에 올리면 DNS 서버를 기본적으로 루트 DNS 관련 정보를 가지고 있다. 클라이언트 쿼리가 자신에게 없다면 루트 DNS에 쿼리하고 루트 DNS에서는 쿼리 한 도메인의 TLD 값을 확인해 해당 TLD 값을 관리하는 DNS가 어디인지 응답한다.

전체 과정을 보면 DNS 가 중심이 되어 루트부터 상위까지 차근차근 쿼리를 보내 결괏값을 알아내고 클라이언트에 응답한다. 호스트가 DNS 서버에 질의했던 방식을 **재귀적 방식**, DNS 서버는 여러 단계로 쿼리를 상위 DNS 서버에 보내는데 이를 **반복적 쿼리**라고 한다.

<그림 7-18>

도메인의 재귀적 쿼리와 반복적 쿼리

1. 사용자 호스트는 'zigispace.net'이라는 도메인 주소의 IP 주소가 로컬 캐시에 저장되어 있는지 확인
2. 로컬 캐시에 저장되어 있지 않으면 사용자 호스트에 설정된 DNS에 'zigispace.net'에 대해 쿼리
3. DNS 서버는 'zigispace.net'이 로컬 캐시와 자체에 설정되어 있는지 직접 확인하고 없으면 해당 도메인을 찾기 위해 루트 NS에. net에 대한 TLD 정보를 가진 도메인 주소를 쿼리
4. 루트 DNS는 'zigispace'의 TLD인 '.net'을 관리하는 TLD 네임 서버 정보를 DNS에 응답
5. DNS는 TLD 네임 서버에 'zigispace.net'에 대한 정보를 다시 쿼리
6. TLD 네임 서버는 'zigispace.net'에 대한 정보를 가진 zigi 네임 서버에 대한 정보를 DNS 서버로 응답
7. DNS는 zigi 네임 서버에 'zigispace.net'에 대한 정보를 다시 쿼리
8. zigi 네임 서버는 'zigispace.net'에 대한 정보를 DNS 응답
9. DNS는 'zigispace.net'에 대한 정보를 로컬 캐시에 저장하고 사용자 호스트에 'zigispace.net에 대한 정보를 응답
10. 사용자 호스트는 DNS로부터 받은 'zigispace.net'에 대한 IP 정보를 이용해 사이트 접속

## 7.2.4 마스터와 슬레이브

- DNS 서버
    - 마스터(Master, Primary) 서버
    - 슬레이브(Slave, Secondary) 서버
    
    마스터와 슬레이브에 우선순위는 존재하지 않고 모두 도메인 쿼리에 응답한다.
    
    두 서버를 구분하는 기분은 도메인에 대한 존(Zone) 파일을 직접 관리하는지 여부이다.
    
    마스터는 존 파일을 직접 생성해 도메인 관련 정보를 관리하고 슬레이브 서버는 마스터에 만들어진 존 파일을 복제한다.
    
    → 이 과정을 영역 전송(Zone Transfer)이라고 한다.
    
    DNS 마스터, 슬레이브 서버는 이중화에서 일반적으로 사용하는 액티브-스탠바이(Active-Standby)나 액티브-액티브(Active-Active) 형태로 구성하지 않는다.
    
    DNS 서버는 마스터 서버에 문제가 발생하고 일정 시간이 지나면 슬레이브 서버도 도메인에 대한 질의에 정상적으로 응답할 수 없다. 이 시간을 만료 시간(Expiry Time)이라고 하고 SOA 레코드에 설정된다.
    만료시간 안에 슬레이브 서버가 마스터 서버에서 존 정보를 가져오지 못하면 슬레이브는 존 정보를 사용할 수 없다.
    따라서 만료시간 안에 마스터 서버를 복구하거나 슬레이브 서버를 마스터로 전환해야만 서비스 장애를 막을 수 있다.
    

## 7.2.5 DNS 주요 레코드

1. A(IPv4 호스트) 레코드
    
    A 레코드는 기본 레코드로 도메인 주소를 IP 주소로 변환하는 레코드이다.
    
    사용자가 DNS에 질의한 도메인 주소를 A 레코드에 설정된 IP 주소로 응답한다.
    
    도메인과 IP 주소를 1:1, 1:N, N:1로 매핑 가능!
    만약 서버 1 대에 여러 웹 서비스를 구동해야 한다면 여러 도메인에 동일한 IP를 매핑하고 HTTP 헤더의 HOST 필드에 도메인을 명시해 웹 서버를 구분해 서비스할 수 있다
    

1. AAAA(IPv6 호스트) 레코드
    
    AAAA 레코드는 A와 달리 IPv6 주소 체계에서 사용되며, A 레코드와 역할은 같다
    

1. CNAME(Canonical Name) 래코드
    
    별칭 이름을 사용하게 해주는 레코드
    
    네임 서버가 CNAME 레코드에 대한 질의를 받으면 CNAME 레코드에 설정된 도메인 정보를 확인하고 그 도메인 정보를 내부적으로 다시 질의한 결과 IP 값을 응답한다.
    
    대표적인 예 : "www"
    
2. SOA(Start Of Authority:권한 시작)
    
    도메인 영역에 대한 권한을 나타내는 레코드
    
    SOA 레코드는 해당 도메인의 주 DNS 서버에 이름을 할당하고, 데이터를 얼마나 오래 캐시에 저장할 수 있는지 지정하는 레코드이고 SOA 레코드가 없을 경우 다른 레코드를 등록할 수 없다.
    

1. NS(Name Server:도메인의 네임 서버)
    
    도메인에 대한 권한이 있는 네임 서버 정보를 설정하는 레코드
    
    한이 있는 네임 서버 정보를 해당 도메인에 설정하는 역할 외에 하위 도메인에 대한 권한을 다른 네임 서버로 위임하는 역할로도 사용됨
    
    cf. 위임서버(Name Server)
    도메인 이름과 IP의 상호변환을 가능하게 해주는 서버
    

1. MX(Mail eXchange:메일 교환기)
    
    메일 서버를 구성할 때 사용되는 레코드
    
    해당 도메인을 메일 주소로 갖는 메일서버를 해당 레코드로 선언한다.
    
    메일서버에서 메일을 보낼 때는 MX 레코드를 참조해 동작하는데 우선순위 값을 이용해 다수의 MX 레코드를 선언할 수 있다.
    

1. PTR(Pointer:포인터)
    
    이 레코드는 A 레코드와 반대로 IP 주소에 대한 질의를 도메인 주소로 응답하기 위한 레코드
    
    A 레코드가 정방향 조회용이라면 PTR은 역방향 조회용이다.
    
    하지만 A와 달리 IP와 도메인이 1:1 관계만 갖는다.
    

1. TXT(TeXT:레코드)
    
    도메인에 대한 설명과 같이 간단한 텍스트를 입력할 수 있는 레코드
    

## 7.2.6 DNS에서 알아두면 좋은 내용

- 도메인 위임
- TTL
- 화이트 도메인
- 한글 도메인

### 1. 도메인 위임(DNS Delegation)

도메인은 그 도메인에 대한 정보를 관리할 수 있는 네임 서버를 지정하지만 도메인 내의 모든 레코드를 그 네임 서버가 직접 관리하지 않고 일부 영역에 대해서는 다른 곳에서 레코드를 관리하도록 위임하기도 한다.

즉, 자신이 가진 도메인 관리 권한을 다른 곳으로 일부 위임해 위임한 곳에서 세부 레코드를 관리하도록 하는 것이다.
이 방법이 가능한 이유는 도메인은 계층 구조이기 때문에 특정 계층의 레코드를 위임하면 해당 레코드의 하위 계층은 함께 위임 처리되기 때문이다.

<그림 7-25>

위임을 통해 특정 도메인의 하위 도메인을 별도로 관리

그림처럼 A DNS 서버는 5개의 레코드 정보가 있다.

이때 도메인 하위에 post영역을 추가하고 해당 영역을 B GSLB에서 관리하려고 할 때 A DNS 서버는 post 영역 관리 권한을 B GSLB로 넘겨줄 수 있다.

즉, 도메인 위임 기능을 쓰면 특정 영역을 다른 네임 서버에서 관리할 수 있는 권한을 위임하게 된다.

특정 영역에 대한 관리 주체를 분리하는 용도로 사용할 수 있어 계열사에서 특정 도메인을 분리하거나 GSLB 등 다양한 용도로 사용 가능하다.

### 2. TTL

도메인의 TTL(Time To Live)은 DNS에 질의해 응답받은 결괏값을 캐시에서 유지하는 시간을 뜻한다.

로컬 캐시에 저장된 도메인 정보를 계속 갖고 있는 것이 아니라 DNS에 설정된 TTL 값에 따라 그 시간만 저장한다.

TTL 값이 클수록 DNS 재귀적 쿼리로 인한 응답 시간을 많이 줄일 수 있고 결과적으로 전체 네트워크 응답 시간이 단축된다.

하지만 DNS에서 도메인 관련 정보가 변경되었을 때 새로 변경된 값으로 DNS 정보 갱신이 오래 걸린다.

TTL 값이 작을수록 DNS의 정보 갱신이 빨라지므로 DNS 쿼리량이 늘어나 DNS 서버 부하가 증가할 수 있다.

그래서 TTL은 상황에 따라 적절히 조절하는 것이 좋다.

### 3. 화이트 도메인

정상적인 도메인을 인증, 관리하는 제도로 스팸메일 차단 활동에 사용된다.

반대로 불법적인 스팸메일을 발송하는 사이트를 실시간 블랙리스트 정보로 관리하는 것을 RBL(Realtime Blackhole List)라고 한다.

그래서 도메인 등록 시 화이트 도메인에 등록해야 하며 사전에 해당 도메인에 SPF(Sender Policy Framework)가 설정되어 있어야 한다.

SPF 레코드를 통해 등록된 정보와 일치하는지 확인한다. 일치하지 않는다면 비정상적인 메일 서버에서 전송된 것으로 간주해 스팸 처리한다.

최대 길이는 512바이트이기 때문에 유의해야 한다.

도메인에 SPF 레코드를 설정하려면 TXT 레코드를 사용한다.

### 4. 한글 도메인

도메인 주소는 한글로도 만들 수 있는데 사용자가 도메인을 한글로 등록하고 DNS에서는 한글을 퓨니코드로 변경하고 이 퓨니코드를 DNS에 도메인을 생성해야 한다.

cf. 퓨니코드(Punycode) : 유니코드 문자열을 호스트 이름에서 허용된 문자만으로 인코딩하는 방법

# 7.3 GSLB

- GSLB (Global Server/Service Load Balancing)
    - DNS 서비스의 발전된 형태
    - DNS는 도메인 주소와 IP를 매핑하여 도메인으로 요청이 들어왔을 때 타켓의 주소로 변환해 주는 서비스!
    - 하나의 도메인 주소에 대해서 여러 개의 IP주소를 넘겨 줄 수 있는데, 이 기능을 이용해서 가용성 구성과 로드 밸랜싱 기능을 수행하기도 함
    - DNS 뒤에 여러 IP를 붙여 고가용성과 로드 밸런싱 역할을 할 수 있긴 하겠지만 근본적으로 한계가 있음
        
        (이유는 DNS의 로드 밸런싱은 IP 목록중 하나를 반환할 뿐, 네트워크 지연, 성능, 트래픽 유입, 서비스 실패 등은 전혀 고려하지 않기 때문)
        
    
    → 이러한 문제를 해결하기 위해 나온 것이 GSLB!
    

## 7.3.1 GSLB 동작 방식

<그림 7-47>

1. 사용자가 web.zigispace.net에 접속하기 위해 DNS에 질의합니다.
2. LDNS는 web.zigispace.net을 관리하는 NS 서버를 찾기 위해 root부터 순차 질의합니다.
3. zigispace.net을 관리하는 NS 서버로 web.zigispace.net에 대해 질의합니다.
4. DNS 서버는 GSLB로 web.zigispace.net에 대해 위임했으므로 GSLB 서버가 NS 서버라고 LDNS 에 응답합니다.
5. LDNS는 다시 GSLB로 web.zigispace.net에 대해 질의합니다.
6. GSLB는 web.zigispace.net에 대한 IP 주솟값 중 현재 설정된 분산 방식에 따라 서 울 또는 부산 데이터 센터의 IP 주솟값을 DNS에 응답합니다. 본 예제에서는 서울 데이 터 센터의 서비스 IP인 1.1.1.1 을 응답하는 것으로 가정합니다. GSLB가 응답하는 값은 GSLB에서 설정한 주기에 따라 서울과 부산 데이터 센터로 헬스 체크해 정상적인 값만 응답합니다.
7. 7. GSLB에서 결왓값을 응답받은 LDNS는 사용자에게 web.zigispace.net이 1.1.1.1 로 서비스하고 있다고 최종 응답합니다.

## 7.3.2 GSLB 동작 방식

- GSLB를 사용한 도메인 설정 방법 2가지
    - 도메인 자체를 GSLB로 사용
    - 도메인 내의 특정 레코드만을 GSLB를 사용

- 특정 레코드에 대해 GSLB를 사용하는 경우
    - 별칭(Alias) 사용 (CNAME 레코드 사용)
        
        <그림 7-49>
        
        1. 사용자가 web.zigispace.net을 LDNS(1.1.1.1)로 질의
        2. LDNS는 web.zigispace.net을 관리하는 NS 서버를 찾기 위해 root부터 순차적으로 질의
        3. zigispace.net을 관리하는 DNS(2.2.2.2)에 web.zigispace.net의 주소 질의
        4. DNS 서버는 LDNS에게 별칭으로 web.zigispace.net은 web.zigispace.gslb.net이 관리하고 있다는 응답 수신
        5. 다시 LDNS(1.1.1.1)는 gslb.net을 관리하는 NS 서버를 root부터 순차 질의
        6. LDNS(1.1.1.1)는 zigispace.gslb.net을 관리하는 NS 서버인 GSLB(3.3.3.3)에 web. zigispace.gslb.net에 대해 질의
        7. GSLB(3.3.3.3)는LDNS(l.l.l.l)에 web.zigispace.gslb.net의 IP(10.10.10.10)를응답
        8. LDNS(1.1.1.1)는 해당 결괏값(10.10.10.10)을 사용자에게 최종 응답
        
    - 위임(Delegation) 사용 (NS 레코드 사용)
        
        <그림 7-50>
        
        1. 사용자가 web.zigispace.net을 LDNS(1.1.1.1)로 질의
        2. LDNS는 web.zigispace.net을 관리하는 NS 서버를 찾기 위해 root부터 순차적으로 질의
        3. zigispace.net을 관리하는 DNS(2.2.2.2)에 web.zigispace.net의 주소 질의 
        4. DNS(2.2.2.2)는 GSLB(3.3.3.3)가 web.zigispace.net을 관리한다고 응답
        5. 다시 LDNS(1.1.1.1)는 web.zigispace.net을 관리하는 NS 서버인 GSLB(3.3.3.3)에 게 web.zigispace.net을 질의
        6. GSLB(3.3.3.3)는 LDNS(1.1.1.1)에 web.zigispace.net의 IP를 응답
        7. LDNS(1.1.1.1)는 해당 결팟.값을 사용자에게 최종 응답
        

## 7.3.3 GSLB 분산 방식

- GSLB를 이용해 서비스를 분산하면 다음과 같은 주요 목적을 달성 가능
    - 서비스 제공의가능 여부를 체크해 트래픽 분산
    - 지리적으로 멀리 떨어진 다른 데이터센터에 트래픽 분산
    - 지역적으로 가까운 서비스에 접속해 더 빠른 서비스 제공이 가능하도록 분산
    
- 각 GSLB에서 지원되는 분산 방식은 GSLB 장비를 생산하는 벤더와 모델에 따라 조금씩 다를 수 있지만 대부분 다음 두 가지 헬스 체크 모니터링 요소를 지원하고 있음
    - 서비스 응답 시간/지연(RTT/Latency)
        
        서비스 요청에 대한 응답이 얼마나 빠른지 또는 지연이 얼마나 없는지를 확인하고 이것을 이용해 서비스를 분산 처리합니다.
        
    - IP에 대한 지리 (Geography) 정보
        
        IP에 대한 지리 정보는 서비스 제공이 가능한 각 사이트의 IP 주소에 대한 Geo 값을 확인해 가까운 사이트로 서비스 분산을 처리합니다.
        

# 7.4 DHCP

호스트가 네트워크와 통신하려면 물리적 네트워크 구성은 물론 IP, 서브넷 마스크, 게이트웨이와 같은 네트워크 정보와 DNS 주소도 설정이 필요합니다. 이런 **네트워크 정보를 호스트에 적용**하려면 사용자가 IP정보를 **직접 설정**하거나 IP 정보를 할당해주는 서버를 이용해 **자동으로 설정**해야 합니다. 수동으로 IP와 네트워크 정보를 직접 설정하는 것을 '**정적 할당**'이라고 하고 자동으로 설정하는 것을 '**동적 할당**'이라고 합니다.

일반적으로 **데이터 센터의 서버 팜과 같은 운영 망에서 사용되는 IP는 주로 정적 할당**을 사용하지만 **PC 사용자를 위해 운영되는 사무실 네트워크에서는 IP를 자동으로 할당받는 동적 할당 방식을 많이 사용**합니다.

이처럼 IP를 동적으로 할당하는 데 사용되는 프로토콜!!

## 7.4.1 DHCP 프로토콜

- DHCP는 BOOTP(Bootstrap Protocol) 라는 프로토콜을 기반으로 함
- DHCP는 BOOTP와 유사하게 동작하지만, BOOTP에서 지원되지 않는 몇 가지 기능이 추가된 확장 프로토콜
- DHCP는 서버와 클라이언트로 동작하며 클라이언트의 서비스 포트는 68(bootpc), 서버의 서비스 포트는 67(bootps)입니다.

## 7.4.2 DHCP 동작 방식

호스트가 DHCP 서버로 IP를 할당받는 과정 - 4단계로 진행됨

<그림 7-53>

1. DHCP Discover
    
    DHCP 클라이언트는 DHCP 서버를 찾기 위해 DHCP DIsvocer 메시지를 브로드캐스트로 전송합니다.
    
2. DHCP Offer
    
    DHCP DIscover를 수신한 DHCP 서버는 클라이언트에 할당할 IP주소와 서브넷, 게이트웨이, DNS 정보, Lease Time 등의 정보를 포함한 DHCP 메시지를 클라이언트로 전송합니다.
    
3. DHCP Request
    
    DHCP 서버로부터 제안받은 IP 주소(Requested IP)와 DHCP 서버 정보( DHCP Server Identifier)를 포함한 DHCP 요청 메시지를 브로드캐스트로 전송합니다.
    
4. DHCP Acknowledgement
    
    DHCP 클라이언트로부터 IP 주소를 사용하겠다는 요청을 받으면 DHCP 서버에 해당 IP를 어떤 클라이언트가 언제부터 사용하기 시작했는지 정보를 기록하고 DHCP Request 메시지를 정상적으로 수신했다는 응답을 전송합니다.
    

## 7.4.3 DHCP 서버 구성

- DHCP 서버를 구성할 때는 클라이언트에 할당하게 될 IP 주소 풀을 포함해 다양한 속성과 정보를 설정할 수 있음
- DHCP 서버를 구성할 때 주로 설정하는 값
    - IP 주소 풀(IP 범위)
        
        클라이언트에 할당할 IP 주소 범위
        
    - 예외 IP 주소 풀(예외 IP 범위)
        
        클라이언트에 할당할 IP 주소로 선언된 범위 중 예외적으로 할당하지 않을 대역
        
    - 임대 시간
        
        클라이언트에 할당할 IP 주소의 기본 임대 시간
        
    - 서브넷 마스크( Subnet Mask)
        
        클라이언트에 할당할 IP 주소에 대한 서브넷 마스크 정보
        
    - 게이트웨이(Router)
        
        클라이언트에 할당할 게이트웨이 정보
        
    - DNS(Domain Name Server)
        
        클라이언트에 할당할 DNS 주소
        

## 7.4.4 DHCP 릴레이

DHCP 서버에서 IP 주소를 할당받기 위해 DHCP 클라이언트와 DHCP 서버 간에 전송되는 패킷은 모두 브로드캐스트입니다. 브로드캐스트는 동일 네트워크에서만 전송되므로 DHCP를 사용하려면 각 네트워크마다 DHCP 서버가 있어야 합니다.

네트워크 대역이 하나로 운영되는 소규모 사업장에서 공유기와 같이 간단한 장비로 DHCP를 운영할 때는 고려할 사항이 많지 않지만 네트워크 영역이 여러 개인 환경에서 DHCP를 이용한다면 DHCP 서버 배치, 이중화와 관련된 다양한 사항을 고려해야 합니다. **아래 그림과 같이 네트워크가 여러 개로 나뉜 환경에서는 DHCP의 브로드캐스트가 전달되지 않으므로 각 네트워크 환경에서 DHCP 서버를 개별적으로 구축해야 할 수 있습니다.**

<그림 7-71>

하지만 여러 네트워크를 가진 환경에서도 **DHCP 릴레이 에이전트(Relay Agent) 기능을 사용하면 DHCP 서버 한 대로 여러 네트워크 대역에서 IP 풀을 관리할 수 있습니다.** DHCP 릴레이 에이전트가 DHCP 클라이언트와 DHCP 서버가 서로 다른 대역에 있는 경우, DHCP 패킷을 중간에서 중계(Relay)하는 역할을 해주기 때문입니다. 아래 그림과 같이 DHCP 릴레이 에이전트의 구성과 통합된 DHCP 서버 구성에서 1.1.1.0/24 대역을 가진 A 네트워크와 2.2.2.0/24 대역을 가진 B 네트워크에 대한 DHCP IP 풀을 3.3.3.0/24 대역인 C 네트워크의 DHCP 서버에서 관리하는 것을 볼 수 있습니다.

이것이 가능한 것은 브로드캐스트로 전달되는 DHCP 패킷을 동일 네트워크 대역의 DHCP 릴레이 에이전트가 수신하면 DHCP 서버로 갈 수 있도록 이것을 유니캐스트로 변환해주는 역할을 하기 때문입니다. **즉, 릴레이 에이전트를 이용하면 DHCP 서버를 네트워크마다 구성하지 않고 중앙 DHCP 서버만으로도 여러 네트워크에서 DHCP 환경을 운영할 수 있습니다.**

<그림 7-72>
