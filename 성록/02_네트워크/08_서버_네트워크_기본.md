# 8장. 서버 네트워크 기본

1) 서버의 네트워크 설정 및 확인
2) 서버의 라우팅 테이블
3) 네트워크 확인을 위한 명령어

---
<br/>

## 1️⃣ 서버의 네트워크 설정 및 확인

서버를 네트워크에 연결해 정상적으로 동작시키려면 먼저 서버에서 환경에 맞는 적절한 네트워크 설정이 필요하다.  
윈도 서버와 리눅스 서버에서 IP 주소, 서브넷, 게이트웨이, DNS IP 주소와 같은 네트워크 기본 설정 및 확인하는 방법에 대해 알아본다.

### ❇️ 리눅스 서버 네트워크

리눅스에서는 네트워크 설정을 텍스트 파일에서 설정한다.

#### CentOS의 네트워크 설정

- **CentOS 네트워크 설정 파일 경로**
  - `/etc/sysconfig/network-scripts`
  - 위 경로의 디렉터리에는 인터페이스에 대한 설정이 있는 `ifcfg-eth0`, `ifcfg-eth1`과 같은 설정 파일과 인터페이스 up/down과 같은 다양한 인터페이스 제어용 스크립트가 있다
  - 각 인터페이스 설정은 하나의 파일에 모든 인터페이스의 설정 정보를 쓰지 않고 인터페이스별 설정 파일로 관리한다
- **네트워크 서비스 재시작 명령어**
  - `$ systemctl restart network.service`
  - 리눅스에서는 설정 파일을 수정하더라도 변경한 값이 즉시 적용되지 않는다
  - 변경된 설정 값을 적용하려면 위 명령어를 통해 네트워크 서비스를 재시작하거나, `ifup/ifdown` 명령어를 이용해 특정 인터페이스를 재시작해야 한다.
- **현재 네트워크 인터페이스의 설정값과 상태를 확인하는 명령어**
  - `$ ifconfig`
  - 윈도의 `ipconfig` 명령어와 매우 유사한데, 리눅스의 `ifconfig`는 현재 활성화된 인터페이스 정보만 확인할 수 있다

#### 우분투의 네트워크 설정

기본적인 네트워크 설정은 위 CentOS와 비슷하여 서로 다른 부분만 소개한다.

- **우분투의 네트워크 설정 파일**
  - `/etc/network/interfaces`
  - CentOS는 네트워크 인터페이스별로 설정 파일이 있었지만, 우분투는 interfaces 파일에 네트워크의 모든 인터페이스 설정이 들어가있다
- **우분투에서 네트워크 서비스를 시작/정지/재시작하기 위한 명령어**
  - `/etc/init.d/networking start`
  - `/etc/init.d/networking stop`
  - `/etc/init.d/networking reload`
  - `/etc/init.d/networking restart`
  - `/etc/init.d/networking force-reload`


### ❇️ 윈도 서버 네트워크

GUI 설정으로 생략...

---
<br/>

## 2️⃣ 서버의 라우팅 테이블

- 네트워크 장비와 같이 서버에서도 외부 네트워크와 통신하기 위해 라우팅 테이블이 존재한다.  
- 네트워크 어댑터를 하나만 사용할 경우, 디폴트 라우팅이 라우팅 테이블에 자동으로 등록되므로 라우팅 정보를 별도로 설정하지 않아도 된다.
- 하지만 두 개 이상의 어댑터를 사용할 경우에는 라우팅 정보를 별도로 직접 조정해주어야 한다.

### ❇️ 서버의 라우팅 테이블

서버의 OS 마다 라우팅 테이블에 들어가는 정보는 모두 조금씩 다르지만 가장 중요한 항목들은 다음과 같다.

- **목적지(Destination)**
- **서브넷(Genmask)**
  - 목적지 네트워크와 서브넷은 서버가 통신하려는 목적지 IP 주소에 맞는 라우팅을 선택하는 기준이 된다.
- **게이트웨이(Gateway)**
  - 선택된 목적지로 가기 위해 서버에서 선택하는 넥스트 홉이다.
- **인터페이스(Iface)**
  - 서버의 네트워크 카드를 말하고, 라우팅에서 어떤 물리적인 겨로로 패킷을 내보낼지 설정한다.
- **우선순위(Metric)**
  - 동일한 라우팅 테이블이 두 개 이상 존재할 때, 어떤 라우팅 테이블을 선택할지 정하는 값이다. 값이 낮을수록 우선순위가 높다.

### ❇️ 리눅스 서버의 라우팅 확인 및 관리

리눅스 서버에서 라우팅 테이블을 확인하려면 `ip route` 명령어를 사용한다.


---
<br/>


## 3️⃣ 네트워크 확인을 위한 명령어

### ❇️ ping (Packet InterNet Groper)

```bash
ping [옵션] 목적지_IP주소

ex) 목적지 8.8.8.8 (google dns)로 100바이트 크기의 ping 패킷을 2회 보내는 예시
ping 8.8.8.8 -c 2 -s 100
```

- 네트워크 상태를 확인할 때 가장 많이 사용되는 명령어이다
- IP 네트워크를 통해 특정 목적지까지 네트워크가 잘 동작하고 있는지 확인하는 네트워크 명령어이다
- 상대방 호스트가 살아 있는지 확인하는 것이 이 명령어의 최대 목표이지만, 두 호스트 간의 통신을 위한 경로, 즉 라우팅 경로가 정상적으로 구성되어 있는지도 함께 체크할 수 있다
- ICMP(Internet Control Message Protocol)라는 인터넷 프로토콜을 사용하며, ICMP의 제어 메시지를 통해 여러가지 네트워크 상태를 파악할 수 있다

### ❇️ tcping (윈도)

- `ping`만으로는 목적지 단말이 잘 살아 있고 중간 경로에 문제가 없더라도 실제 서비스를 위해 사용되는 서비스 포트가 정상 상태인지를 모두 확인할 수는 없다  
  (방화벽, icmp 메시지 차단 등)
- tcping 프로그램을 통해 서비스 포트가 정상적으로 열려 있는지 확인할 수 있다.

### ❇️ traceroute(리눅스) / tracert(윈도)

```bash
예시) Google DNS(8.8.8.8)까지의 경로 추적

c:\>tracert 8.8.8.8
```

- `traceroute`는 출발지부터 통신하거나 목적지까지의 네트워크 경로를 확인할 때 사용하는 네트워크 명령어이다
- `ping`보다 중간 경로의 더 상세한 정보를 얻는 데 사용된다
- 중간 네트워크 장비가 아닌 출발지 pc에서 목적지까지의 라우팅 경로를 확인할 수 있고, 목적지까지의 통신에 문제가 있을 때 어느 구간부터 문제가 발생했는지 찾아낼 수 있다
- 추가로 목적지까지의 네트워크 응답 시간이 느린 경우, 어느 구간에서 응답 시간이 느려지는지도 알아낼 수 있다
- `traceroute`는 IP 헤더의 TTL(Time to Live) 필드를 이용하며, 이 값을 1부터 1씩 증가시키면서 목적지에 도달할 때까지 패킷을 반복적으로 전송하면서 경로를 추척한다
- `traceroute` 경로 추적은 IP 헤더인 3계층 정보에 의한 경로 추적이므로 2계층 이하의 스위치 장비 추적은 불가능하다

### ❇️ tcptraceroute

- `ping`과 `tcping`의 관계처럼 `traceroute`도 경로 정보 뿐만 아니라 서비스 포트를 추가로 확인할 수 있는 명령어이다
- `traceroute`는 경로 추적만 가능하며 서비스를 위한 서비스 포트가 정상적으로 열리는지 확인할 수 없다
- `tcptraceroute`는 서비스에 문제가 생겼을 때 어느 구간에서 막혔는지 확인할 수 있다

### ❇️ netstat (network statistics)

- `netstat`은 서버의 **다양한 네트워크 상태를 확인**할 때 사용하는 명령어이다
- 여러 가지 네트워크 관련 정보를 확인할 수 있어 사용 범위가 매우 넓지만, 그 중에서 **서비스 포트 상태를 확인하는 용도**로 가장 많이 사용된다
- 현재 서버에서 특정 서비스가 정상적으로 열려 있는지(LISTENING), 외부 서비스와 TCP 세션이 정상적으로 맺어져 있는지(ESTABLISHED), 서비스가 정상적으로 종료되고 있는지(TIME_WAIT, FIN_WAIT, CLOSE_WAIT) 여부 등을 확인할 수 있다
- 다만, 이를 잘 사용하려면 TCP 통신에 대한 상태 변화와 동작 방식을 정확히 이해하고 있어야 한다

### ❇️ ss (socket statistics)

- `ss`는 소켓 정보를 확인할 수 있는 네트워크 명령어이다
- 기존 `netstat` 명령어를 대체하는 것뿐만 아니라 다양한 옵션을 제공해 더 많은 정보를 추가로 확인할 수 있다

### ❇️ nslookup (name server lookup)

- `nslookup`은 DNS에 다양한 도메인 관련 내용을 질의해 결괏값을 전송받을 수 있는 네트워크 명령어이다
- 가장 자주 사용되는 질의는 특정 도메인에 매핑된 IP 주소를 확인하는 것이다

### ❇️ telnet (tele network)

- 텔넷은 원격지 호스트에 터미널 연결을 위해 사용되는 매우 오래된 표준 프로토콜이다
- 서버에 접근해 관리하는 용도로 사용되었는데, 텔넷은 평문(Plane Text)을 사용하므로 해커에 의해 통신 내용을 감청당할 수 있어 보안에 취약하다
- 따라서 현대에는 주로 공개 키 방식의 암호화를 통해 통신하는 보안 프로토콜인 SSH(Secure Shell)를 사용한다

### ❇️ ipconfig

- `ipconfig`는 네트워크 설정을 확인하는 윈도 네트워크 명령어이다
- 위에서 다뤘던 리눅스의 `ifconfig` 기본 명령어 외에 자주 사용되는 옵션은 다음과 같다
  - `ipconfig /release`: 네트워크 주소 해제
  - `ipconfig /renew`: 네트워크 주소 갱신
    - DHCP 환경에서 할당받은 현재 IP 주소를 해제하고 갱신하는 옵션이다
    - IP 주소를 정상적으로 할당받지 못한 경우 위 두 작업이 필요하다
  - `ipconfig /displaydns`
    - 로컬에 저장된 DNS 캐시 정보를 확인하는 명령어
  - `ipconfig /flushdns`
    - 로컬에 저장된 DNS 캐시 정보를 초기화하는 명령어

### ❇️ tcpdump

- `tcpdump`는 네트워크 인터페이스로 오가는 패킷을 캡처해 보는 기능의 명령어이다
- 장애 처리나 패킷 분석이 필요할 때 자주 사용하는 명령어이다
- 명령어 옵션을 통해 분석에 필요한 패킷만 필터링해서 캡처할 수도 있다
